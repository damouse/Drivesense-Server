<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

<% provide(:title, 'All Trips') %>
<%- model_class = Trip -%>

<div class='row'>
  <% if flash[:notice] %>
    <div id="notice"><div class="alert alert-success"><%= flash[:notice] %></div></div>
  <% end %>
  <% if flash[:success] %>
    <div id="notice"><div class="alert alert-success"><%= flash[:success] %></div></div>
  <% end %>
  <% if flash[:error] %>
    <div id="notice"><div class="alert alert-danger"><%= flash[:error] %></div></div>
  <% end %>
  <% if flash[:warning] %>
    <div id="notice"><div class="alert alert-warning"><%= flash[:warning] %></div></div>
  <% end %>

<% unless current_user.group.nil? %>
  <p>You are a member of <%= "#{current_user.group.name}." %></p>
<% end %>

  

</div>

<%= will_paginate @trips %>

<!-- Start Grid -->
<!-- Scary fluidity- making divs boxes no matter what. http://jsfiddle.net/B8FU8/2441/
Be careful! this will almost certainly mess with bs internals and cause calamity -->

<!-- Ajaxy pagination here http://www.codebeerstartups.com/2012/11/pagination-with-ajax-using-will-paginate-in-ruby-on-rails -->

<% rows = (@trips.size.to_f / 3).ceil - 1 %>
<% cols = @trips.size  - ((@trips.size - 1) / 3) * 3 - 1%>

<div class="black-container">
  <% for i in 0..rows %>
    <div class="row grid-row">

    <!-- Row/Column math -->
    <% max_column = cols if i == rows %>
    <% max_column = 2 if i != rows %>

    <% for n in 0..max_column %>
    <% trip = @trips[i*3 + n] %>

      
      <div class="col-sm-4 grid-cell">
        <%= link_to tripviewer_path(trip) do %>
          <div class="grid-map" id="map-<%=trip.id%>"></div>

          <!-- put metadata labels here -->
          <div> 
            <div class='row map-thumbnail-description'>
              <div class="col-sm-6 map-thumbnail-label-left">
                <p><%= trip.time_stamp.strftime('%b %d, %I:%M%P') %></p>
              </div>

              <div class="col-sm-6 map-thumbnail-label-right">
                <p><%= trip.distance.round(2) %> miles</p>
              </div>
            </div>

            <div class='row map-thumbnail-description'>
              <div class="col-sm-6 map-thumbnail-label-left">
                <p><%= get_hours(trip.duration) %>h <%= get_mins(trip.duration) %>m <%= get_secs(trip.duration) %>s</p>
              </div>

              <div class="col-sm-6 map-thumbnail-label-right">
                <p>Score: <%=trip.score.scoreAverage%></p>
              </div>
            </div>
          </div>

        <%end %>
      </div>
      

    <% end %>
    </div>
  <% end %>
</div>
<%= high_chart("graph", @chart) %>
<hr />


<!-- End Grid -->

<% @trips.each do |trip| %>
  <script type="text/javascript">
      <% handler = "handler" + trip.id.to_s %>
      <%= handler %> = Gmaps.build('Google');
      <%= handler %>.buildMap({ provider: {disableDefaultUI: true, draggable: false, scrollwheel: false}, internal: {id: 'map-<%=trip.id%>'}}, function(){
          markers = <%= handler %>.addMarkers(<%=raw trip.gmaps_endpoints %>);
          polyline = <%= handler %>.addPolyline(<%=raw trip.gmaps_coordinates %>); 
          <%= handler %>.bounds.extendWith(polyline);
          <%= handler %>.fitMapToBounds();
      });
  </script>
<% end %>
